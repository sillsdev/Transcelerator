<?xml version="1.0" encoding="UTF-8"?>
<!-- These variables define the Windows Installer product version, product code and upgrade code. They   -->
<!-- will be used later on in this file.  this value should be B U I L D_SCRIPT_MUST_REPLACE_AT_RUNTIME (in quotes) -->
<?define Property_ProductVersion = "BUILD_SCRIPT_MUST_REPLACE_AT_RUNTIME" ?>

<!-- * means auto-generate a new guid each time. This is "a unique identifier for the particular product release" -->
<?define Property_ProductCode = "*" ?>

<!--Don't even think of EVER changing this, despite the counter-intuitive name. What it is: "a shared identifier that represents multiple versions of an application" -->
<?define Property_UpgradeCode = "{6CA771D3-AA98-4cab-8616-2777C8EEA23D}" ?>

<!-- good intro to the component vs. file thing, and why each file here is a separate component:
http://blogs.msdn.com/robmen/archive/2003/10/04/56479.aspx -->

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

    <Product Id="$(var.Property_ProductCode)" Name="Transcelerator $(var.Property_ProductVersion)" Language="1033"
             Version="$(var.Property_ProductVersion)" Manufacturer="SIL International"
             UpgradeCode="$(var.Property_UpgradeCode)">

        <Package Platform="x64" Compressed="yes" InstallerVersion="200" Manufacturer="SIL International" InstallScope="perMachine" />

        <MajorUpgrade Schedule="afterInstallInitialize"
                      DowngradeErrorMessage="A later version of Transcelerator is already installed. If you really want to downgrade, first uninstall Transcelerator, then do this install again." />

        <!-- show the license page -->
        <UIRef Id="WixUI_FeatureTree" />
        <!-- Top banner / 493 × 58 -->
        <WixVariable Id='WixUIBannerBmp' Value='installerBanner.jpg' />
        <!-- Background bitmap used on the welcome and completion dialogs / 493 × 312 -->
        <WixVariable Id='WixUIDialogBmp' Value='installerBackground.jpg' />
        <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

        <!-- 
    "from the list: Don't use Advertise="yes" Advertised shortcuts are designed to allow
    users to install just the shortcut for your app, then demand-install the
    rest of the app the first time the icon is run.  If this is not behavior you
    are trying to support, you're better off using non-advertised shortcuts. "-->

        <Property Id="PARATEXT9" Secure="yes">
			<RegistrySearch Win64="no"
							Id="Paratext9"
                            Root="HKLM"
                            Key="SOFTWARE\Paratext\8"
                            Name="Paratext9_Full_Release_AppPath"
                            Type="directory" />
        </Property>
        <Condition Message="This version of Transcelerator requires Paratext 9.2 or later. For earlier versions of Paratext 9, use the latest version of Transcelerator 2.0. For Paratext 8, use the 32-bit installer (version 1.5.x).">
            <![CDATA[Installed OR PARATEXT9]]>
        </Condition>

        <Property Id="PARATEXT92ORGREATER" Secure="yes">
          <DirectorySearch Id="ParatextExeVersion" Path="[PARATEXT9]">
            <FileSearch Name="Paratext.exe" MinVersion="9.2.0.0" />
          </DirectorySearch>
        </Property>
        <Condition Message="Before Transcelerator can install, you need to install Paratext 9.2 or later.">
          <![CDATA[Installed OR PARATEXT92ORGREATER]]>
        </Condition>
		
        <Binary Id="CustomInstallerActions.CA.dll"
                SourceFile="CustomInstallerActions/bin/x64/Release/CustomInstallerActions.CA.dll" />

        <CustomAction Id="RemoveAllTransceleratorUserCacheFiles"
                      Return="asyncWait"
                      Execute="deferred"
                      Impersonate="no"
                      BinaryKey="CustomInstallerActions.CA.dll"
                      DllEntry="RemoveAllTransceleratorUserCacheFiles" />

        <Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFiles64Folder" Name="PFiles">
				<Directory Id="PARATEXT9" Name="ParatextDir9">
					<Directory Id="PLUGINDIR9" Name="plugins">
						<Directory Id="INSTALLDIR9" Name="Transcelerator">
							<Directory Id="INSTALLDIR9_LOCALIZATION" Name="localization"/>
							<Directory Id="DocsDirP9" Name="docs">
								<Directory Id="DocsDirP9_es" Name="es"/>
							</Directory>
						</Directory>
					</Directory>
				</Directory>
			</Directory>
        </Directory>

        <ComponentGroup Id="COMPONENTSFORP9PLUGIN" Directory="INSTALLDIR9" Source="..\Transcelerator\bin\x64\Release">
            <Component Guid="*">
                <File Id="Transcelerator.dll_P9" ShortName="x6bjjpu5.dll" KeyPath="yes" Name="Transcelerator.ptxplg" />
            </Component>
            <Component Guid="*">
                <File Id="keyTermRules.xml_P9" ShortName="y9ks2bq7.xml" KeyPath="yes" Name="keyTermRules.xml" />
            </Component>
            <Component Guid="*">
                <File Id="keyTermRules.xsd_P9" ShortName="34caw2bf.xsd" KeyPath="yes" Name="keyTermRules.xsd" />
            </Component>
            <Component Guid="*">
                <File Id="TxlQuestions.xml_P9" ShortName="12jl5fgc.xml" KeyPath="yes" Name="TxlQuestions.xml" />
            </Component>
            <Component Guid="*">
                <File Id="TxlQuestionWords.xml_P9" ShortName="5yzuh6br.xml" KeyPath="yes" Name="TxlQuestionWords.xml" />
            </Component>
            <Component Guid="*">
                <File Id="Analytics.NET.dll_P9" ShortName="t9a1cxl9.dll" KeyPath="yes" Name="Analytics.NET.dll" />
            </Component>
            <Component Guid="*">
                <File Id="DesktopAnalytics.dll_P9" ShortName="avcjefr2.dll" KeyPath="yes" Name="DesktopAnalytics.dll" />
            </Component>
            <Component Guid="*">
                <File Id="Newtonsoft.Json.dll_P9" ShortName="malr336y.dll" KeyPath="yes" Name="Newtonsoft.Json.dll" />
            </Component>
            <Component Guid="*">
                <File Id="TxlCore.dll_P9" ShortName="47v9a799.dll" KeyPath="yes" Name="TxlCore.dll" />
            </Component>
            <Component Guid="*">
                <File Id="L10NSharp.dll_P9" ShortName="apdq6l10.dll" KeyPath="yes"
                      Name="L10NSharp.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SilUtils.dll_P9" ShortName="mdx6az21.dll" KeyPath="yes" Name="SilUtils.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SIL.WritingSystems.dll_P9" ShortName="u3wozlbp.dll" KeyPath="yes"
                      Name="SIL.WritingSystems.dll" />
            </Component>
			<!-- ICU and dependencies - Could make these conditional if no localizations are installed.
				But the code would also need to be made to handle the case of no icu.net.dll (by catching
				exception?)-->
			<Component Guid="*">
				<File Id="icu.net.dll_P9" ShortName="icunetp9.dll" KeyPath="yes" Name="icu.net.dll" />
			</Component>
			<Component Guid="*">
				<File Id="Microsoft.Extensions.DependencyModel.dll_P9" ShortName="msedmp9.dll" KeyPath="yes" Name="Microsoft.Extensions.DependencyModel.dll"/>
			</Component>
			<Component Guid="*">
				<File Id="icudt62.dll_86_P9" ShortName="dt62p9.dll" KeyPath="yes" Source="..\Transcelerator\bin\x64\Release\lib\win-x64\icudt62.dll" />
			</Component>
			<Component Guid="*">
				<File Id="icuin62.dll_86_P9" ShortName="in62p9.dll" KeyPath="yes" Source="..\Transcelerator\bin\x64\Release\lib\win-x64\icuin62.dll" />
			</Component>
			<Component Guid="*">
				<File Id="icuuc62.dll_86_P9" ShortName="uc62p9.dll" KeyPath="yes" Source="..\Transcelerator\bin\x64\Release\lib\win-x64\icuuc62.dll" />
			</Component>
			<!-- End ICU -->
            <Component Guid="*">
                <File Id="SIL.Windows.Forms.Keyboarding.dll_P9" ShortName="tp04hoif.dll" KeyPath="yes"
                      Name="SIL.Windows.Forms.Keyboarding.dll" />
            </Component>
            <Component Guid="*">
                <File Id="Keyman7Interop.dll_P9" ShortName="t39ghpsp.dll" KeyPath="yes"
                      Name="Keyman7Interop.dll" />
            </Component>
            <Component Guid="*">
                <File Id="Keyman10Interop.dll_P9" ShortName="j7kojtod.dll" KeyPath="yes"
                      Name="Keyman10Interop.dll" />
            </Component>
            <Component Guid="*">
                <File Id="KeymanLink.dll_P9" ShortName="w2zqsf2z.dll" KeyPath="yes"
                      Name="KeymanLink.dll" />
            </Component>
		    <Component Guid="*">
			    <File Id="Markdig.Signed.dll_P9" ShortName="x8d4bn3u.dll" KeyPath="yes"
                      Name="Markdig.Signed.dll" />
		    </Component>
            <Component Guid="*">
                <File Id="SIL.Windows.Forms.Scripture.dll_P9" ShortName="avbbno1j.dll" KeyPath="yes"
                      Name="SIL.Windows.Forms.Scripture.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SIL.Scripture.dll_P9" ShortName="hq9z3a0z.dll" KeyPath="yes" Name="SIL.Scripture.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SIL.Windows.Forms.dll_P9" ShortName="6cm4n2mk.dll" KeyPath="yes" Name="SIL.Windows.Forms.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SIL.Core.dll_P9" ShortName="fqfi7v4n.dll" KeyPath="yes" Name="SIL.Core.dll" />
            </Component>
            <Component Guid="*">
                <File Id="SIL.Core.Desktop.dll_P9" ShortName="3ibsrrdb.dll" KeyPath="yes" Name="SIL.Core.Desktop.dll" />
            </Component>
            <Component Guid="*">
                <File Id="Transcelerator.pdb_P9" ShortName="8o1biihw.pdb" KeyPath="yes" Name="Transcelerator.pdb" />
            </Component>
            <Component Guid="*">
                <File Id="ComprehensionCheckingData.dll_P9" ShortName="nr1q7tyv.dll" KeyPath="yes"
                      Name="ComprehensionCheckingData.dll" />
            </Component>
            <Component Guid="*">
                <File Id="ComprehensionCheckingData.pdb_P9" ShortName="f7c1i78x.pdb" KeyPath="yes"
                      Name="ComprehensionCheckingData.pdb" />
            </Component>
            <Component Guid="*">
                <File Id="TxlCore.pdb_P9" ShortName="j8i37ie7.pdb" KeyPath="yes" Name="TxlCore.pdb" />
            </Component>
            <Component Guid="*">
                <File Id="SilUtils.pdb_P9" ShortName="lcaifco3.pdb" KeyPath="yes" Name="SilUtils.pdb" />
            </Component>
            <Component Guid="*">
                <File Id="Icon_P9" ShortName="44tpy8ze.ico" KeyPath="yes" Name="TXL no TXL.ico" />
            </Component>
            <Component Guid="*">
                <File Id="CreditsAndLicense.htm_P9" ShortName="qgigfgzl.htm" KeyPath="yes" Name="CreditsAndLicense.htm" />
            </Component>
            <Component Id="Transcelerator.dll.config_P9" Guid="*">
                <File Id="Transcelerator.dll.config_P9" ShortName="abh9z0kp.cfg" KeyPath="yes"
                      Name="Transcelerator.dll.config" />
            </Component>
            <Component Id="ReleaseNotes.md_P9" Guid="*">
                <File Id="ReleaseNotes.md_P9" ShortName="p0rdflid.md" Source="..\DistFiles\ReleaseNotes.md" />
            </Component>
        </ComponentGroup>

        <Feature Id="PluginFeature_P9" Level="0" Title="Plugin for Paratext 9" AllowAdvertise="no">
            <Condition Level="1"><![CDATA[PARATEXT92ORGREATER]]></Condition>
            <ComponentGroupRef Id="COMPONENTSFORP9PLUGIN" />
			<Component Id="CreateP9LocalizationFolder" Directory="INSTALLDIR9_LOCALIZATION" Guid="{FFFD2FB8-E7EE-4806-8910-96B2D166FD14}">
				<CreateFolder />
				<!-- Note: Transcelerator requires this folder even if none
				of the "Localizations" sub-features is installed. Unfortunately,
				it seems that even with a RemoveFolder element, this folder does
				not get removed. Though it seems counterintuitive, my guess is
				that the uninstall order is such that the remove is attempted
				before the installed xlf files are removed. If this hypothesis
				is correct, presumably RemoveEx could solve this, but then it
				might cause another problem because it would prematurely delete
				files that the installer wants to remove gracefully. For now, I
				think this is not worth additional time trying to figure out. -->
			</Component>
            <Feature Id="Localization_P9" Level="1" Title="Localizations" InstallDefault="followParent"
                     AllowAdvertise="no">
                <Feature Id="Localization_P9_enGB" Level="1" Title="English (United Kingdom)" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGIN_enGB" />
                </Feature>
                <Feature Id="Localization_P9_es" Level="1" Title="español" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGIN_es" />
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_es" />
                </Feature>
                <Feature Id="Localization_P9_fr" Level="1" Title="français" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGIN_fr" />
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_fr" />
                </Feature>
				<!-- I wanted to use the same language names as are displayed in the UI. For
				languages that use characters not a Latin script, that means displaying the
				Romanized name in parentheses after the language name in the native script.
				Unfortunately, WIX/MSI does not support Unicode and is limited to a single
				codepage. It gives an error if this file contains UI strings that are not in
				the default/specified codepage (1252 in this case). For reference purposes,
				I have noted in a comment the preferred title. -->
                <Feature Id="Localization_P9_ar" Level="1" Title="Arabic" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: العربية (Arabic) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ar" />
                </Feature>
                <Feature Id="Localization_P9_az" Level="1" Title="Azerbaijani" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: azərbaycan -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_az" />
                </Feature>
                <Feature Id="Localization_P9_id" Level="1" Title="Bahasa Indonesia" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_id" />
                </Feature>
                <Feature Id="Localization_P9_bn" Level="1" Title="Bangla" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: বাংলা (Bangla) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_bn" />
                </Feature>
                <Feature Id="Localization_P9_my" Level="1" Title="Burmese" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: ဗမာ (Burmese) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_my" />
                </Feature>
                <Feature Id="Localization_P9_zh" Level="1" Title="Chinese (Traditional)" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: 中文(台灣) (Chinese (Traditional)) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_zh" />
                </Feature>
                <Feature Id="Localization_P9_zhCN" Level="1" Title="Chinese (Simplified)" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: 中文(中国) (Chinese (Simplified)) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_zhCN" />
                </Feature>
                <Feature Id="Localization_P9_de" Level="1" Title="Deutsch" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_de" />
                </Feature>
                <Feature Id="Localization_P9_hi" Level="1" Title="Hindi" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: हिन्दी (Hindi) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_hi" />
                </Feature>
                <Feature Id="Localization_P9_km" Level="1" Title="Khmer" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: ខ្មែរ (Khmer) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_km" />
                </Feature>
                <Feature Id="Localization_P9_rw" Level="1" Title="Kinyarwanda" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_rw" />
                </Feature>
                <Feature Id="Localization_P9_sw" Level="1" Title="Kiswahili" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_sw" />
                </Feature>
                <Feature Id="Localization_P9_ko" Level="1" Title="Korean" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: 한국어 (Korean) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ko" />
                </Feature>
                <Feature Id="Localization_P9_hu" Level="1" Title="magyar" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_hu" />
                </Feature>
                <Feature Id="Localization_P9_ms" Level="1" Title="Melayu" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ms" />
                </Feature>
                <Feature Id="Localization_P9_ne" Level="1" Title="Nepali" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: नेपाली (Nepali) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ne" />
                </Feature>
                <Feature Id="Localization_P9_fa" Level="1" Title="Persian" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: فارسی (Persian) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_fa" />
                </Feature>
                <Feature Id="Localization_P9_pt" Level="1" Title="português" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_pt" />
                </Feature>
                <Feature Id="Localization_P9_ru" Level="1" Title="Russian" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: русский (Russian) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ru" />
                </Feature>
                <Feature Id="Localization_P9_ta" Level="1" Title="Tamil" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: தமிழ் (Tamil) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ta" />
                </Feature>
                <Feature Id="Localization_P9_te" Level="1" Title="Telugu" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: తెలుగు (Telugu) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_te" />
                </Feature>
                <Feature Id="Localization_P9_th" Level="1" Title="Thai" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: ไทย (Thai) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_th" />
                </Feature>
                <Feature Id="Localization_P9_tr" Level="1" Title="Türkçe" InstallDefault="followParent"
                         AllowAdvertise="no">
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_tr" />
                </Feature>
                <Feature Id="Localization_P9_ur" Level="1" Title="Urdu" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: اُردو (Urdu) -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_ur" />
                </Feature>
                <Feature Id="Localization_P9_vi" Level="1" Title="Vietnamese" InstallDefault="followParent"
                         AllowAdvertise="no"> <!-- Preferred title: Tiếng Việt -->
                    <ComponentGroupRef Id="COMPONENTSFORP9PLUGINLOCALIZATION_vi" />
                </Feature>
            </Feature>
			<Feature Id="Documentation_P9" Level="1" Title="Documentation" InstallDefault="followParent"
                     AllowAdvertise="no">
                <ComponentGroupRef Id="COMPONENTSFORP9Documentation_en" />
				<Feature Id="Documentation_P9_es" Level="1" Title="español" InstallDefault="followParent"
                         AllowAdvertise="no">
					<ComponentGroupRef Id="COMPONENTSFORP9Documentation_es" />
                </Feature>
            </Feature>
        </Feature>
					  
        <!-- INSTALLSTATE_LOCAL = 3 -->
		<!-- INSTALLSTATE_ABSENT = 2 -->
        <InstallExecuteSequence>
            <Custom Action="RemoveAllTransceleratorUserCacheFiles" After="RemoveRegistryValues"></Custom>
        </InstallExecuteSequence>

        <Media Id="1" Cabinet="product.cab" EmbedCab="yes" />

        <!-- Icon you see in add/remove programs control panel -->
        <Icon Id="Transcelerator.ico" SourceFile="..\Transcelerator\bin\x64\Release\Transcelerator.ptxplg" />
        <Property Id="ARPPRODUCTICON" Value="Transcelerator.ico" />
    </Product>
</Wix>

